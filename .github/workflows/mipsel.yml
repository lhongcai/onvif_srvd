name: Build for MIPSel Linux  
  
on:  
  push:  
    branches: [ main, master ]  
  pull_request:  
    branches: [ main, master ]  
  workflow_dispatch:  
  
jobs:  
  build-mipsel:  
    runs-on: ubuntu-latest  
      
    steps:  
    - name: Checkout code  
      uses: actions/checkout@v4  
      with:  
        submodules: recursive  
          
    - name: Install dependencies  
      run: |  
        sudo apt update  
        sudo apt install -y \  
          cmake \  
          make \  
          m4 \  
          flex \  
          bison \  
          byacc \  
          yacc \  
          wget \  
          unzip \  
          patch  
            
    - name: Setup MIPSel toolchain  
      run: |  
        # 安装MIPSel交叉编译工具链  
        sudo apt install -y gcc-mipsel-linux-gnu g++-mipsel-linux-gnu  
          
        # 验证工具链  
        mipsel-linux-gnu-gcc --version  
        mipsel-linux-gnu-g++ --version  
          
    - name: Configure CMake for MIPSel  
      run: |  
        cmake -B build-mipsel \  
          -DCMAKE_BUILD_TYPE=Release \  
          -DCMAKE_SYSTEM_NAME=Linux \  
          -DCMAKE_SYSTEM_PROCESSOR=mipsel \  
          -DCMAKE_C_COMPILER=mipsel-linux-gnu-gcc \  
          -DCMAKE_CXX_COMPILER=mipsel-linux-gnu-g++ \  
          -DCMAKE_FIND_ROOT_PATH=/usr/mipsel-linux-gnu \  
          -DCMAKE_FIND_ROOT_PATH_MODE_PROGRAM=NEVER \  
          -DCMAKE_FIND_ROOT_PATH_MODE_LIBRARY=ONLY \  
          -DCMAKE_FIND_ROOT_PATH_MODE_INCLUDE=ONLY \  
          -DUSE_SYSTEM_GSOAP=0  
            
    - name: Build  
      run: |  
        cmake --build build-mipsel --parallel $(nproc)  
          
    - name: Upload artifacts  
      uses: actions/upload-artifact@v4  
      with:  
        name: onvif_srvd-mipsel  
        path: build-mipsel/onvif_srvd  
        retention-days: 30
